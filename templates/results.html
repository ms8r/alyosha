$def with (rwa, search_str, cat_src, match_score, min_wc, back_days, back_link)

$var page_id: results-page

$var title: Thify.org - Results

$var cssfiles: static/styles.css

$var jsfiles: static/jquery-2.1.1.min.js static/results.js

$code:
    # max. number of results to show per category:
    max_res = 3

$def render_res(r):
    $code:
        score = "%.2f" % r['score']

    <h3><a href="$r['url']">$r['title']</a></h2>
    <h4>$r['link']</h3>
    <p class="match-score">$r['wc'] words, score: $score</p>
    <p class="res-description">$r['desc']</p>
    

$def cat_res(c_matches, c_discards, max_res):
    $if c_matches is None:
        $pass
    $elif not c_matches:
        <p><em>No full matches found in this category</em></p>
    $else:
        $code:
            n = min(max_res, len(c_matches))

        $for r in c_matches[:n]:
            $:render_res(r)

    $if c_discards:
        <p><em>Articles that failed to meet the full match criteria</em></p>
        $code:
            n = min(max_res, len(c_discards))

        $for r in c_discards[:n]:
            $:render_res(r)

<h1>Recommended reading</h1>
<div id="results-top-box">
    <p>Based on the article <em><a href="$rwa.url">$rwa.title</a></em>, a search for <em>'$search_str'</em> yields the following results:</p>
</div>
<div class="spectrum">
    <table>
        <thead>
            <tr>
            $for c in cat_src:
                $if loop.first:
                    $ label = 'On the {0}...'.format(c)
                $elif loop.last:
                    $ label = '...and on the {0}'.format(c)
                $else:
                    $ label = '...in the {0}...'.format(c)
        
                <th>$label</th>
            </tr>
        </thead>
        <tbody>
            <tr>
            $for c in cat_src:
                $# m, __ = results[c]
                <td>
                    <ul id="$c-match">
                    $# :cat_res(m, None, max_res=max_res)
                    </ul>
                </td>
            </tr>
            <tr>
            $for c in cat_src:
                $# __, d = results[c]
                <td>
                    <ul id="$c-discard">
                    $# :cat_res(None, d, max_res=max_res)
                    </ul>
                </td>
            </tr>
        </tbody>
    </table>
</div>
$# parameters for JS script:
<param id="wa-key" name="wa_key" value="$rwa.key" />
<param id="search-str" name="search_str" value='$search_str' />
$for k, v in cat_src.iteritems():
    $ v_str = ' '.join(v)
    <param class="cat-src" name="$k" value="$v_str" />
<param id="match-score" name="match_score" value="$match_score" />
<param id="min-wc" name="min_wc" value="$min_wc" />
<param id="back-days" name="back_days" value="$back_days" />

</div>
